cmake_minimum_required(VERSION 3.10)
project(sylar_network LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# è·å–å½“å‰ç›®å½•çš„ç»å¯¹è·¯å¾„
get_filename_component(SRC_DIR ${CMAKE_CURRENT_SOURCE_DIR} REALPATH)

# æ”¶é›†æ‰€æœ‰ .cpp æ–‡ä»¶ï¼ˆè¿”å›ç»å¯¹è·¯å¾„ï¼‰
file(GLOB ALL_CPP_FILES "${SRC_DIR}/*.cpp")

# è°ƒè¯•ï¼šæ‰“å°æ‰€æœ‰æ–‡ä»¶
message(STATUS "ğŸ” æ‰€æœ‰ .cpp æ–‡ä»¶: ${ALL_CPP_FILES}")

# å®šä¹‰è¦æ’é™¤çš„æ–‡ä»¶ï¼ˆå¿…é¡»ç”¨å®Œæ•´è·¯å¾„ï¼‰
set(EXCLUDE_FILES
    ${SRC_DIR}/server.cpp
    ${SRC_DIR}/client.cpp
)

# ä»åˆ—è¡¨ä¸­ç§»é™¤
set(COMMON_SOURCES ${ALL_CPP_FILES})
list(REMOVE_ITEM COMMON_SOURCES ${EXCLUDE_FILES})

# è°ƒè¯•ï¼šæ‰“å°å…¬å…±æºæ–‡ä»¶
message(STATUS "âœ… å…¬å…±æºæ–‡ä»¶ (ä¸å« main): ${COMMON_SOURCES}")

# ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
add_executable(server server.cpp ${COMMON_SOURCES})
add_executable(client client.cpp ${COMMON_SOURCES})

# é“¾æ¥ç³»ç»Ÿåº“
target_link_libraries(server pthread dl rt)
target_link_libraries(client pthread dl rt)